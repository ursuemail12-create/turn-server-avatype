# Coturn Configuration File for Fly.io
# STUN/TURN Server Settings

# Basic Configuration
listening-port=3478
tls-listening-port=5349
listening-ip=0.0.0.0
# External IP will be auto-detected by entrypoint.sh
external-ip=${COTURN_EXTERNAL_IP}
realm=${COTURN_REALM:-turn-server-avatype.fly.dev}
server-name=avatype-turn-server

# Authentication
lt-cred-mech
user=${COTURN_USER:-avatype}:${COTURN_PASSWORD:-changeme123}

# Security
no-tlsv1
no-tlsv1_1
tlsv1_2
no-tlsv1_3
# Use simpler cipher list for Alpine compatibility
cipher-list="DEFAULT"
no-stun
fingerprint

# Performance Settings
no-stdout-log
log-file=/var/log/coturn/turn.log
simple-log
verbose
proc-user=turnserver
proc-group=turnserver

# Port Allocation
min-port=${COTURN_MIN_PORT:-49152}
max-port=${COTURN_MAX_PORT:-65535}

# Relay Settings
no-tcp-relay
no-udp-relay
# Enable these only if you need TURN relay
# max-bps=1000000
# bps-capacity=10000000

# STUN-only mode (we want STUN, not TURN)
stun-only

# Security restrictions
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=192.168.0.0-192.168.255.255
denied-peer-ip=172.16.0.0-172.31.255.255

# Reduce logging for production
no-verbose
no-stats