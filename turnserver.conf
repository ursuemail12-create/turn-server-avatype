# Avatype STUN/TURN Server Configuration
# Production-ready configuration for Fly.io

# ===========================================
# Network Configuration
# ===========================================
listening-port=3478
tls-listening-port=5349
listening-ip=0.0.0.0

# External IP will be set by entrypoint.sh via command line
# Do NOT set external-ip here - it breaks with "auto-detected"

# Relay configuration
relay-ip=0.0.0.0
min-port=49152
max-port=49252

# ===========================================
# Server Identity
# ===========================================
realm=turn.avatype.com
server-name=avatype-turn

# ===========================================
# Authentication
# ===========================================
# Use time-limited credentials (recommended for WebRTC)
use-auth-secret
# Static auth secret is set via environment variable in entrypoint.sh

# Long-term credential mechanism
lt-cred-mech

# ===========================================
# Protocol Settings
# ===========================================
# Enable both STUN and TURN
# (Remove fingerprint if you have compatibility issues)
fingerprint

# Allow UDP and TCP
# Note: For STUN-only, you could add "stun-only" but we want full TURN support

# ===========================================
# TLS/DTLS Security
# ===========================================
no-tlsv1
no-tlsv1_1
# Cipher list for TLS
cipher-list="ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256"

# ===========================================
# Performance
# ===========================================
# Disable CLI (not needed in container)
no-cli

# Number of relay threads (adjust based on expected load)
relay-threads=4

# Rate limiting
user-quota=12
total-quota=1200
max-bps=0

# ===========================================
# Logging
# ===========================================
# Log to stdout for Docker/Fly.io
log-file=stdout
simple-log
# Enable verbose for debugging, disable in production
# verbose

# ===========================================
# Security Hardening
# ===========================================
# Prevent relay to private networks
no-loopback-peers
no-multicast-peers

# Block private IP ranges from being relay targets
denied-peer-ip=0.0.0.0-0.255.255.255
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=100.64.0.0-100.127.255.255
denied-peer-ip=127.0.0.0-127.255.255.255
denied-peer-ip=169.254.0.0-169.254.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.0.0.0-192.0.0.255
denied-peer-ip=192.0.2.0-192.0.2.255
denied-peer-ip=192.88.99.0-192.88.99.255
denied-peer-ip=192.168.0.0-192.168.255.255
denied-peer-ip=198.18.0.0-198.19.255.255
denied-peer-ip=198.51.100.0-198.51.100.255
denied-peer-ip=203.0.113.0-203.0.113.255
denied-peer-ip=240.0.0.0-255.255.255.255

# Stale nonce protection
stale-nonce=600

# Mobility with ICE (MICE) support
mobility
