# Coturn Configuration File
# STUN/TURN Server Settings

# Basic Configuration
listening-port=3478
tls-listening-port=5349
listening-ip=0.0.0.0
# External IP will be set by entrypoint.sh
external-ip=${COTURN_EXTERNAL_IP}
realm=${COTURN_REALM:-avatype.com}
server-name=avatype-turn-server

# Security & Authentication
lt-cred-mech
use-auth-secret
static-auth-secret=${COTURN_AUTH_SECRET}
user=${COTURN_USER}:${COTURN_PASSWORD}
# For dynamic credentials (recommended for production)
# userdb=/var/lib/coturn/turndb
# redis-userdb="ip=127.0.0.1 dbname=0 password=turn"

# Performance Settings
no-stdout-log
log-file=/var/log/coturn.log
syslog
simple-log
fingerprint
# long-term-credential
# no-auth

# Port Allocation
min-port=${COTURN_MIN_PORT:-49152}
max-port=${COTURN_MAX_PORT:-65535}
max-bps=1000000  # 1 Mbps per connection limit
bps-capacity=10000000  # 10 Mbps total capacity

# Protocol Support
no-tlsv1
no-tlsv1_1
tlsv1_2
tlsv1_3
# Cipher suite for TLS
cipher-list="HIGH"
no-loopback-peers
no-multicast-peers

# NAT Traversal
stun-only
# Turn off relay functionality when not needed
# no-tcp-relay
# no-udp-relay

# ICE Support
ice-lite
no-cli

# Logging
verbose
# Alternatively, use minimal logging in production:
# no-verbose

# Security Hardening
no-software-attribute
mobility
no-stun
# Prevent amplification attacks
no-udp
udp-self-threshold=3
proc-user=turnserver
proc-group=turnserver

# Database (optional for production)
# redis-statsdb="ip=127.0.0.1 dbname=1 password=turn"
# psql-userdb="host=localhost dbname=coturn user=turn password=turn connect_timeout=30"

# Rate limiting
stale-nonce=600
no-multicast-peers
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=192.168.0.0-192.168.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
allowed-peer-ip=0.0.0.0/0

# Relay Settings
no-tcp
no-udp
relay-threads=50
lt-cred-mech

# STUN-specific settings
stun-only
# These are for TURN functionality - comment out for pure STUN
# no-tcp-relay
# no-udp-relay

# TURN REST API (optional)
# use-auth-secret
# realm=yourdomain.com
# static-auth-secret=yoursecret

# Verbose output for debugging
# Remove in production
log-file=stdout